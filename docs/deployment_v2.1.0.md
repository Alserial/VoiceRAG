# VoiceRAG v2.1.0 部署指南

本文档说明如何部署 VoiceRAG v2.1.0 版本，包含智能回答模式和版本号显示功能。

---

## 🎯 版本 v2.1.0 更新内容

### 主要功能
- ✅ **智能回答模式**: Agent 现在可以回答知识库外的问题
- ✅ **版本号显示**: 页面右下角显示版本号 `v2.1.0`
- ✅ **用户体验提升**: 不再说"我不知道"

### 技术改进
- 修改系统消息逻辑，支持知识库 + GPT 混合回答
- 添加版本号显示组件
- 优化回答流程

---

## 📦 部署文件

### 文件信息
- **文件名**: `voicerag-v2.1.0.zip`
- **大小**: ~30.7 MB
- **位置**: 项目根目录
- **内容**: 完整的 app 目录

### 文件结构
```
voicerag-v2.1.0.zip
├── backend/
│   ├── app.py (已更新系统消息)
│   ├── static/ (前端构建文件)
│   └── ...
└── frontend/
    ├── src/App.tsx (已添加版本号)
    └── ...
```

---

## 🚀 部署步骤

### 方法 1: Azure Portal 部署 (推荐)

#### 步骤 1: 登录 Azure Portal
1. 访问 [Azure Portal](https://portal.azure.com)
2. 登录您的 Azure 账户

#### 步骤 2: 找到 Container App
1. 搜索 "Container Apps"
2. 选择您的 Container App: `capps-backend-bgvscddssk7zk`

#### 步骤 3: 创建新修订版本
1. 在左侧菜单选择 "Revisions"
2. 点击 "Create new revision"
3. 选择 "Upload artifact"
4. 上传 `voicerag-v2.1.0.zip`

#### 步骤 4: 配置部署
1. **Image source**: Upload artifact
2. **Artifact**: 选择上传的 `voicerag-v2.1.0.zip`
3. **Tag**: `v2.1.0`
4. 点击 "Create"

#### 步骤 5: 应用更新
1. 等待修订版本创建完成
2. 点击 "Apply" 应用新版本
3. 等待部署完成

### 方法 2: Azure CLI 部署

```bash
# 登录 Azure
az login

# 设置订阅
az account set --subscription "your-subscription-id"

# 更新 Container App
az containerapp update \
  --name capps-backend-bgvscddssk7zk \
  --resource-group voicerag-prod \
  --image your-registry.azurecr.io/voicerag:v2.1.0
```

---

## ✅ 部署验证

### 1. 检查版本号
- 访问应用页面
- 查看右下角是否显示 `v2.1.0`
- 版本号应该很小，不干扰用户体验

### 2. 测试智能回答
**知识库内问题**:
```
用户: "What is Contoso Electronics?"
预期: 使用知识库信息 + 显示引用
```

**知识库外问题**:
```
用户: "What's the capital of France?"
预期: 使用 GPT 知识回答，无引用
```

### 3. 功能测试
- ✅ 语音交互正常
- ✅ 知识库搜索正常
- ✅ 智能回答模式生效
- ✅ 版本号显示正确

---

## 🔍 部署状态检查

### 成功标志
- ✅ 页面右下角显示 `v2.1.0`
- ✅ 应用功能正常工作
- ✅ 语音交互正常
- ✅ 智能回答模式生效

### 失败标志
- ❌ 版本号未更新
- ❌ 页面显示旧版本
- ❌ 功能异常
- ❌ 控制台报错

---

## 📊 版本对比

| 功能 | v2.0.0 | v2.1.0 |
|------|--------|--------|
| 语言锁定 | ✅ | ✅ |
| RAG 功能 | ✅ | ✅ |
| 智能回答 | ❌ | ✅ |
| 版本显示 | ❌ | ✅ |
| 用户体验 | 基础 | 增强 |

---

## 🛠️ 故障排除

### 问题 1: 版本号未显示
**可能原因**:
- 前端构建失败
- 静态文件未更新
- 缓存问题

**解决方案**:
1. 重新构建前端
2. 清除浏览器缓存
3. 检查静态文件路径

### 问题 2: 智能回答不工作
**可能原因**:
- 系统消息未更新
- 后端未重启
- 配置问题

**解决方案**:
1. 检查 `app.py` 中的系统消息
2. 重启 Container App
3. 验证环境变量

### 问题 3: 部署失败
**可能原因**:
- 文件格式错误
- 权限问题
- 资源不足

**解决方案**:
1. 检查 ZIP 文件完整性
2. 验证 Azure 权限
3. 检查资源配额

---

## 📝 部署记录

### 部署信息
- **版本**: v2.1.0
- **部署时间**: 2025年10月25日
- **部署方式**: Azure Portal
- **文件大小**: 30.7 MB
- **部署状态**: 待部署

### 更新内容
1. **智能回答模式**: 支持知识库外问题回答
2. **版本号显示**: 页面右下角显示版本
3. **用户体验**: 提升对话体验

---

## 🎉 部署完成

部署成功后，您的 VoiceRAG Agent 将具备：

- ✅ **完整对话能力**: 可以回答任何问题
- ✅ **智能切换**: 自动在知识库和 GPT 间切换
- ✅ **版本追踪**: 通过版本号确认更新状态
- ✅ **用户友好**: 不会说"不知道"

现在您可以通过页面右下角的版本号轻松确认部署状态！🎯

---

**部署文件**: `voicerag-v2.1.0.zip`  
**版本号**: v2.1.0  
**部署时间**: 2025年10月25日  
**维护者**: VoiceRAG 团队







