# 通过 Azure Portal 更新 RAG 文档指南

本文档详细说明如何通过 Azure Portal 网页界面上传新文档到 VoiceRAG 知识库。

---

## 概述

当您想让 VoiceRAG Agent 能够回答关于新文档的问题时，需要将文档上传到 Azure Blob Storage 并触发索引器，使文档被索引到搜索系统中。

**整个过程分为两步：**
1. 上传文件到 Blob Storage
2. 运行索引器处理文件

**预计时间：** 5-10 分钟

---

## 第一步：上传文件到 Blob Storage

### 1. 登录 Azure Portal

访问：https://portal.azure.com

使用您的 Azure 账户登录

### 2. 找到存储账户

**方法 A：直接搜索**
1. 在页面顶部的搜索框中输入：`stbgvscddssk7zk`
2. 在搜索结果中点击存储账户

**方法 B：通过资源组**
1. 在搜索框中输入：`rg-voicerag-prod`
2. 点击资源组
3. 在资源列表中找到存储账户 `stbgvscddssk7zk`
4. 点击进入

### 3. 进入容器页面

1. 在存储账户页面，查看左侧菜单
2. 找到 **"Data storage"** 部分（可能需要点击展开）
3. 点击 **"Containers"**（容器）

### 4. 选择数据容器

1. 您会看到容器列表
2. 找到名为 **`content`** 的容器（存储文档的容器）
3. 点击容器名称进入

### 5. 上传文件

1. 在容器页面，点击顶部的 **"Upload"**（上传）按钮
2. 在右侧弹出的上传面板中：
   - 点击 **"Browse for files"**（浏览文件）或直接拖拽文件
   - 选择您要上传的文件（PDF、Word、Markdown 等）
   - 可以一次选择多个文件

3. **配置上传选项**（可选）：
   - **Authentication type**（身份验证类型）：保持默认
   - **If files already exist**（如果文件已存在）：
     - 选择 **"Overwrite"**（覆盖）来更新现有文件
     - 或选择 **"Ignore"**（忽略）来跳过重复文件

4. 点击 **"Upload"** 按钮开始上传

5. 等待上传完成，您会在列表中看到新上传的文件

---

## 第二步：运行索引器

文件上传后，需要运行索引器来将文档内容索引到搜索系统中。

### 1. 返回资源组

1. 点击页面顶部的面包屑导航中的 **资源组名称**
2. 或者在搜索框中重新搜索：`rg-voicerag-prod`

### 2. 找到 AI Search 服务

1. 在资源组的资源列表中找到 AI Search 服务
2. 名称：`gptkb-bgvscddssk7zk`
3. 类型：Search service（搜索服务）
4. 点击进入

### 3. 打开索引器页面

1. 在 AI Search 服务页面，查看左侧菜单
2. 找到 **"Indexers"**（索引器）
3. 点击进入

### 4. 运行索引器

1. 您会看到索引器列表（通常只有一个）
2. 索引器名称可能是：`voicerag-intvect` 或类似名称
3. 点击索引器名称进入详情页
4. 点击顶部的 **"Run"**（运行）按钮
5. 在确认对话框中点击 **"Yes"**

### 5. 监控索引进度

1. 在索引器详情页面，查看 **"Execution History"**（执行历史记录）
2. 最新的运行应该显示状态：
   - 🔄 **In Progress**（进行中）- 正在处理
   - ✅ **Success**（成功）- 完成
   - ❌ **Failed**（失败）- 需要查看错误

3. **预计时间**：
   - 小文件：1-2 分钟
   - 大文件或多个文件：3-5 分钟
   - 很大的 PDF：可能需要 5-10 分钟

---

## 验证文档已成功索引

### 方法 1: 在应用中测试（推荐）

1. **访问 VoiceRAG 应用**：
   https://capps-backend-bgvscddssk7zk.mangohill-557d5c8b.brazilsouth.azurecontainerapps.io

2. **开始对话**：
   - 点击 "Start conversation" 按钮
   - 询问与新上传文档相关的问题

3. **验证结果**：
   - 如果 Agent 能够回答并引用新文档，说明索引成功
   - 查看回答下方是否显示了新文档作为来源

### 方法 2: 在 Azure Portal 中查看索引

1. **进入 AI Search 服务**：`gptkb-bgvscddssk7zk`

2. **查看索引**：
   - 左侧菜单 → **"Indexes"**（索引）
   - 点击索引名称（`voicerag-intvect`）

3. **使用搜索浏览器**：
   - 点击 **"Search explorer"**（搜索浏览器）
   - 输入新文档中的关键词
   - 点击 **"Search"**
   - 如果返回结果包含新文档内容，说明索引成功

---

## 支持的文件格式

您可以上传以下类型的文件：

| 文件类型 | 扩展名 | 说明 |
|---------|--------|------|
| PDF 文档 | `.pdf` | 最常用的文档格式 |
| Word 文档 | `.docx`, `.doc` | Microsoft Word 文件 |
| Markdown | `.md` | 纯文本标记文件 |
| 文本文件 | `.txt` | 纯文本 |
| PowerPoint | `.pptx`, `.ppt` | 演示文稿 |
| Excel | `.xlsx`, `.xls` | 表格数据 |
| HTML | `.html`, `.htm` | 网页文件 |

**建议：**
- 文件大小不超过 100MB
- 使用英文文件名（避免特殊字符）
- 确保文件编码为 UTF-8（对于文本文件）

---

## 常见问题

### Q: 上传后多久可以查询新文档？

**A**: 通常 2-5 分钟。具体时间取决于：
- 文件大小（大文件需要更长时间）
- 文件数量（批量上传需要更长时间）
- 系统负载

### Q: 如何更新已存在的文件？

**A**: 
1. 使用相同的文件名重新上传
2. 在上传时选择 "Overwrite"（覆盖）
3. 重新运行索引器
4. 等待索引完成

### Q: 如何删除不需要的文档？

**A**:
1. 在 Blob Storage 容器中找到文件
2. 选中文件，点击 **"Delete"**（删除）按钮
3. 确认删除
4. 运行索引器，系统会自动从索引中移除该文档

### Q: 为什么索引器显示失败？

**A**: 可能的原因：
- 文件格式不支持
- 文件损坏
- 文件太大
- 需要 OCR（如果是扫描的 PDF）

**解决方法：**
1. 查看索引器的错误详情
2. 尝试转换文件格式（如 PDF → Markdown）
3. 检查文件是否完整
4. 分割大文件为小文件

### Q: 可以上传中文文档吗？

**A**: 完全可以！
- 系统支持多语言文档
- 确保文件使用 UTF-8 编码
- Agent 可以理解和回答中文文档内容

---

## 批量上传文档

如果需要上传大量文档：

### 方法 1: 在 Portal 中批量选择

1. 在上传面板中，点击 "Browse for files"
2. 按住 `Ctrl` 键选择多个文件
3. 或者按住 `Shift` 键选择连续的文件
4. 点击 "Upload"

### 方法 2: 使用拖放

1. 在文件资源管理器中选择多个文件
2. 直接拖拽到 Azure Portal 的上传区域
3. 点击 "Upload"

### 方法 3: 使用 Azure Storage Explorer（推荐大量文件）

1. 下载并安装 Azure Storage Explorer
2. 连接到您的存储账户
3. 找到 `content` 容器
4. 拖拽整个文件夹上传

---

## 最佳实践

### 上传前

1. **检查文件**：
   - 确保文件没有损坏
   - 验证文件格式正确
   - 文件名使用英文

2. **准备文件**：
   - 整理到一个文件夹
   - 按类型或主题分组
   - 删除重复或过时的文件

### 上传时

1. **批量操作**：
   - 相同类型的文件一起上传
   - 避免单个文件太大

2. **检查进度**：
   - 确认所有文件都上传成功
   - 查看文件列表验证

### 上传后

1. **立即运行索引器**：
   - 不要等待自动运行
   - 手动触发确保及时处理

2. **验证结果**：
   - 在应用中测试新文档
   - 检查索引器执行历史
   - 确认文档计数增加

---

## 故障排除

### 问题 1: 找不到容器

**解决方案**：
1. 确认在正确的存储账户中
2. 检查容器名称（可能是 `content`、`documents` 或其他）
3. 查看所有容器，找到包含文件的容器

### 问题 2: 上传失败

**解决方案**：
1. 检查文件大小（是否超过限制）
2. 验证网络连接
3. 确认有存储账户的写入权限
4. 重试上传

### 问题 3: 索引器找不到新文件

**解决方案**：
1. 确认文件上传到正确的容器
2. 检查索引器数据源配置
3. 手动运行索引器
4. 查看索引器错误日志

### 问题 4: 应用查询不到新内容

**解决方案**：
1. 等待更长时间（有时需要 10 分钟）
2. 检查索引器是否成功运行
3. 刷新应用页面
4. 使用文档中的确切关键词搜索

---

## 操作时间估算

| 步骤 | 预计时间 |
|------|----------|
| 登录 Azure Portal | 30 秒 |
| 找到存储账户 | 30 秒 |
| 上传文件（单个 10MB） | 1-2 分钟 |
| 上传文件（批量 100MB） | 3-5 分钟 |
| 运行索引器 | 2-5 分钟 |
| 验证结果 | 1-2 分钟 |
| **总计** | **5-15 分钟** |

---

## 快速操作流程

### 简化步骤：

1. **Azure Portal** → 搜索 `stbgvscddssk7zk`
2. **Data storage** → **Containers** → **content**
3. **Upload** → 选择文件 → **Upload**
4. **返回** → 搜索 `gptkb-bgvscddssk7zk`
5. **Indexers** → 选择索引器 → **Run**
6. **等待 2-5 分钟**
7. **测试应用** → 询问新文档相关问题

---

## 资源定位快速参考

### 您的 Azure 资源

| 资源 | 名称 | 用途 |
|------|------|------|
| **资源组** | `rg-voicerag-prod` | 包含所有资源 |
| **存储账户** | `stbgvscddssk7zk` | 存储文档文件 |
| **容器** | `content` | 文档存储位置 |
| **AI Search** | `gptkb-bgvscddssk7zk` | 搜索服务 |
| **索引器** | `voicerag-intvect` | 处理和索引文档 |
| **Container App** | `capps-backend-bgvscddssk7zk` | 运行应用 |

### 应用链接

**最新 URL**：
https://capps-backend-bgvscddssk7zk.mangohill-557d5c8b.brazilsouth.azurecontainerapps.io

---

## 示例：上传新的公司政策文档

### 场景

您有一份新的公司政策文档 `company_policy_2024.pdf`，需要让 Agent 能够回答相关问题。

### 操作步骤

1. **登录 Azure Portal**

2. **搜索存储账户**：
   - 输入 `stbgvscddssk7zk`
   - 点击进入

3. **进入容器**：
   - Data storage → Containers → content

4. **上传文件**：
   - 点击 "Upload"
   - 选择 `company_policy_2024.pdf`
   - 点击 "Upload"

5. **运行索引器**：
   - 搜索 `gptkb-bgvscddssk7zk`
   - Indexers → 选择索引器 → Run

6. **等待 3 分钟**

7. **测试**：
   - 访问应用
   - 问："What is our company policy for 2024?"
   - 验证 Agent 能够回答

---

## 高级技巧

### 批量上传多个文件

**场景**：需要一次上传 10 份文档

**步骤**：
1. 在上传面板中点击 "Browse for files"
2. 按住 `Ctrl` 键，选择所有需要的文件
3. 点击 "Upload"
4. 等待所有文件上传完成
5. 运行索引器一次即可处理所有文件

### 组织文档结构

虽然 Blob Storage 是扁平结构，但您可以：

**使用文件夹前缀**：
- `policies/hr_policy.pdf`
- `policies/it_policy.pdf`
- `handbooks/employee_handbook.pdf`

**好处**：
- 便于管理和查找
- 可以按类别过滤
- 更清晰的组织结构

### 定期维护

**建议每月：**
1. 审查存储的文档
2. 删除过时的文件
3. 更新修订的文档
4. 添加新的文档

---

## 监控和优化

### 查看存储使用情况

1. 在存储账户页面 → **"Metrics"**（指标）
2. 查看：
   - 存储容量使用
   - 事务数量
   - 可用性

### 查看索引状态

1. 在 AI Search 服务页面 → **"Indexes"**
2. 查看索引统计：
   - 文档数量
   - 索引大小
   - 最后更新时间

### 优化建议

1. **压缩大文件**：
   - 减小 PDF 文件大小
   - 使用压缩的图片

2. **删除重复内容**：
   - 定期清理旧版本文档
   - 避免存储重复文件

3. **使用合适的格式**：
   - Markdown 比 PDF 更高效
   - 纯文本比扫描 PDF 更好

---

## 获取帮助

### 如果遇到问题

1. **查看日志**：
   - Azure Portal → AI Search → Indexers → Execution History
   - 查看错误详情

2. **检查权限**：
   - 确认有存储账户的写入权限
   - 确认索引器有读取 Blob 的权限

3. **联系支持**：
   - 查看项目文档
   - 在 GitHub 提交 Issue
   - 联系 Azure 技术支持

---

**祝您使用顺利！**

*最后更新：2025年11月*
















