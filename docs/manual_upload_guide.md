# Azure Portal 手动上传文件指南

本文档介绍如何通过 Azure Portal 手动上传新文件到 VoiceRAG 应用的知识库。

---

## 📋 目录

- [概述](#概述)
- [前提条件](#前提条件)
- [步骤 1: 上传文件到 Blob Storage](#步骤-1-上传文件到-blob-storage)
- [步骤 2: 运行索引器](#步骤-2-运行索引器)
- [验证上传成功](#验证上传成功)
- [常见问题](#常见问题)
- [故障排除](#故障排除)

---

## 概述

当本地脚本上传遇到环境问题时，使用 Azure Portal 手动上传是最可靠的方法：

```
本地文件 → Azure Portal → Blob Storage → 索引器 → 搜索索引 → 可被查询
```

**优势**：
- ✅ 不需要配置本地环境
- ✅ 可视化操作，简单直观
- ✅ 可以实时查看上传进度
- ✅ 支持大文件上传

**预计时间**：5-10 分钟

---

## 前提条件

- ✅ Azure 账户已登录
- ✅ 有访问 VoiceRAG 资源的权限
- ✅ 文件已准备好（PDF、Word、Markdown 等）

**您的资源信息**：
- 资源组：`rg-voicerag-prod`
- 存储账户：`stbgvscddssk7zk`
- AI Search 服务：`gptkb-bgvscddssk7zk`

---

## 步骤 1: 上传文件到 Blob Storage

### 1.1 登录 Azure Portal

访问：https://portal.azure.com

### 1.2 找到存储账户

**方法 A: 直接搜索**
1. 在顶部搜索框中输入：`stbgvscddssk7zk`
2. 点击搜索结果中的存储账户

**方法 B: 通过资源组**
1. 搜索：`rg-voicerag-prod`
2. 进入资源组
3. 找到存储账户 `stbgvscddssk7zk`

### 1.3 进入容器页面

1. 在存储账户页面，点击左侧菜单中的 **"Data storage"** 展开
2. 点击 **"Containers"** (容器)
3. 您会看到容器列表

### 1.4 选择数据容器

找到用于存储文档的容器（通常名称类似）：
- `content`
- 或与您的索引名称相同
- 或包含 "data" 关键词

**如果不知道容器名称**：
- 查看容器列表，通常数据容器会有文件
- 点击容器名称查看内容

### 1.5 上传文件

1. **点击容器名称**进入容器内部
2. **点击顶部的 "上传" 按钮**
3. **选择文件**：
   - 点击 "浏览文件" 或拖拽文件
   - 选择您要上传的文件
4. **配置上传选项**（可选）：
   - **如果文件已存在**：选择 "覆盖" 或 "跳过"
   - **身份验证类型**：保持默认
5. **点击 "上传" 按钮**

**上传示例**：
```
文件 1: 2019 Liberal Party of Australia Federal Constitution.pdf
文件 2: FederalPlatform.pdf
```

### 1.6 确认上传成功

上传完成后，您会在容器中看到新文件：
- ✅ 文件名显示在列表中
- ✅ 文件大小和修改时间正确
- ✅ 状态显示为 "已上传"

---

## 步骤 2: 运行索引器

### 2.1 找到 AI Search 服务

**方法 A: 直接搜索**
1. 在顶部搜索框中输入：`gptkb-bgvscddssk7zk`
2. 点击搜索结果中的 AI Search 服务

**方法 B: 通过资源组**
1. 返回资源组 `rg-voicerag-prod`
2. 找到 AI Search 服务 `gptkb-bgvscddssk7zk`

### 2.2 进入索引器页面

1. 点击 AI Search 服务
2. 在左侧菜单中找到 **"索引器"** (Indexers)
3. 点击进入

### 2.3 选择并运行索引器

1. **查看索引器列表**：
   - 通常只有一个索引器
   - 名称可能与索引名称相同
   - 状态显示 "已启用"

2. **点击索引器名称**进入详情页

3. **运行索引器**：
   - 点击顶部的 **"运行"** (Run) 按钮
   - 系统会提示确认，点击 "是"

### 2.4 监控索引进度

1. **查看执行历史**：
   - 点击 **"执行历史记录"** (Execution History)
   - 查看最新运行的状态

2. **状态说明**：
   - 🔄 **进行中** (InProgress)：正在处理文件
   - ✅ **成功** (Success)：索引完成
   - ❌ **失败** (Failed)：需要查看错误详情

3. **预计时间**：
   - 小文件：1-2 分钟
   - 大文件：3-5 分钟
   - PDF 文件：2-3 分钟

---

## 验证上传成功

### 方法 1: 在应用中测试（推荐）

1. **访问应用**：
   ```
   https://capps-backend-bgvscddssk7zk.gentleisland-734d3c33.brazilsouth.azurecontainerapps.io/
   ```

2. **开始对话**：
   - 点击 "Start conversation"
   - 询问与新文件相关的问题

3. **测试问题示例**：
   ```
   英文: "What is the Liberal Party of Australia Federal Constitution?"
   中文: "澳大利亚自由党联邦宪法是什么？"
   
   英文: "Tell me about the Federal Platform."
   中文: "告诉我关于联邦平台的信息。"
   ```

4. **成功标志**：
   - ✅ AI 能够回答相关问题
   - ✅ 回答中包含新文档的信息
   - ✅ 底部显示引用源文档

### 方法 2: 查看索引统计

1. **进入 AI Search 服务**
2. **点击 "索引"** (Indexes)
3. **选择索引**查看统计信息：
   - 文档数量增加
   - 存储大小增加
   - 最后更新时间

### 方法 3: 使用搜索浏览器

1. **在 AI Search 服务中点击 "搜索浏览器"** (Search explorer)
2. **搜索新文档中的关键词**
3. **查看返回的结果**

---

## 常见问题

### Q1: 找不到容器怎么办？

**A**: 检查以下位置：
1. 确认在正确的存储账户中
2. 查看所有容器，数据容器通常有文件
3. 容器名称可能包含：`content`、`data`、`documents` 等

### Q2: 上传失败怎么办？

**A**: 可能的原因和解决方案：
1. **文件太大**：Azure 有文件大小限制
2. **网络问题**：重试上传
3. **权限问题**：确认有存储账户的写入权限
4. **文件格式**：确保是支持的格式（PDF、Word、Markdown 等）

### Q3: 索引器运行失败怎么办？

**A**: 排查步骤：
1. **查看错误详情**：在 "执行历史记录" 中点击失败的运行
2. **检查文件格式**：确保文件没有损坏
3. **检查权限**：索引器需要读取 Blob Storage 的权限
4. **重新运行**：有时是临时问题，重试即可

### Q4: 上传后多久可以查询？

**A**: 时间线：
- **上传完成**：立即
- **索引器运行**：1-5 分钟
- **可以查询**：索引完成后立即

### Q5: 可以上传哪些文件格式？

**A**: 支持格式：
- ✅ PDF 文件
- ✅ Word 文档 (.docx, .doc)
- ✅ Markdown 文件 (.md)
- ✅ 纯文本文件 (.txt)
- ✅ PowerPoint (.pptx, .ppt)
- ✅ Excel (.xlsx, .xls)
- ✅ HTML 文件

### Q6: 如何更新已存在的文件？

**A**: 两种方式：
1. **覆盖上传**：使用相同文件名上传新版本
2. **删除后重新上传**：先删除旧文件，再上传新文件

---

## 故障排除

### 问题 1: 无法找到存储账户

**解决方案**：
1. 确认登录了正确的 Azure 账户
2. 检查订阅权限
3. 尝试通过资源组访问

### 问题 2: 上传按钮不可用

**可能原因**：
- 没有存储账户的写入权限
- 浏览器兼容性问题

**解决方案**：
1. 联系管理员获取权限
2. 尝试使用 Chrome 或 Edge 浏览器
3. 清除浏览器缓存

### 问题 3: 索引器一直显示"进行中"

**解决方案**：
1. 等待更长时间（大文件可能需要 10+ 分钟）
2. 检查文件是否损坏
3. 查看索引器的详细日志
4. 尝试停止并重新运行索引器

### 问题 4: 应用查询不到新内容

**排查步骤**：
1. 确认索引器运行成功
2. 等待 2-3 分钟让索引生效
3. 刷新应用页面
4. 使用文档中的确切关键词查询
5. 检查文件内容是否可读（不是扫描图片）

---

## 📊 操作时间估算

| 操作 | 预计时间 | 说明 |
|------|----------|------|
| 登录 Azure Portal | 30 秒 | - |
| 找到存储账户 | 30 秒 | - |
| 上传文件 | 1-3 分钟 | 取决于文件大小 |
| 找到 AI Search | 30 秒 | - |
| 运行索引器 | 2-5 分钟 | 取决于文件大小 |
| 验证结果 | 1-2 分钟 | - |
| **总计** | **5-10 分钟** | - |

---

## 🎯 最佳实践

### 上传前准备
1. **检查文件**：确保文件没有损坏
2. **文件命名**：使用英文文件名，避免特殊字符
3. **文件大小**：建议单个文件 < 100MB

### 上传时注意
1. **批量上传**：可以同时选择多个文件上传
2. **覆盖策略**：新版本文件选择"覆盖"
3. **网络稳定**：确保网络连接稳定

### 上传后验证
1. **立即验证**：上传后立即运行索引器
2. **测试查询**：使用应用测试新内容
3. **监控状态**：关注索引器的执行状态

---

## 📚 相关资源

- [Azure Blob Storage 文档](https://learn.microsoft.com/azure/storage/blobs/)
- [Azure AI Search 索引器文档](https://learn.microsoft.com/azure/search/search-indexer-overview)
- [VoiceRAG 项目文档](../README.md)

---

## 🆘 获取帮助

如果遇到问题：

1. **查看 Azure 文档**：参考官方文档
2. **检查权限**：确认有必要的 Azure 权限
3. **联系支持**：Azure 技术支持
4. **项目 Issues**：在 GitHub 项目页面提交问题

---

**最后更新**: 2025年10月  
**适用版本**: VoiceRAG v1.0  
**维护者**: VoiceRAG 团队










