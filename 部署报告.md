# VoiceRAG é¡¹ç›®éƒ¨ç½²æŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: VoiceRAG - Azure AI Search + GPT-4o Realtime Audio  
**éƒ¨ç½²æ—¥æœŸ**: 2025å¹´10æœˆ22æ—¥  
**éƒ¨ç½²ç¯å¢ƒ**: voicerag-prod  
**éƒ¨ç½²è€—æ—¶**: 13åˆ†2ç§’  
**éƒ¨ç½²çŠ¶æ€**: âœ… æˆåŠŸ

---

## ğŸ¯ éƒ¨ç½²ç›®æ ‡

éƒ¨ç½²ä¸€ä¸ªåŸºäºè¯­éŸ³äº¤äº’çš„ RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) åº”ç”¨ï¼Œä½¿ç”¨ Azure OpenAI çš„ GPT-4o Realtime API å®ç°è¯­éŸ³å¯¹è¯åŠŸèƒ½ã€‚

---

## âš ï¸ é‡åˆ°çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜ï¼šAzure OpenAI é…é¢ä¸è¶³

**é”™è¯¯ä¿¡æ¯**:
```
InsufficientQuota: This operation require 1 new capacity in quota 
Requests Per Minute - gpt-4o-realtime-preview - GlobalStandard, 
which is bigger than the current available capacity 0. 
The current quota usage is 1 and the quota limit is 1.
```

**é—®é¢˜åˆ†æ**:
1. åˆå§‹éƒ¨ç½²æ—¶é€‰æ‹©äº† `eastus2` ä½œä¸º OpenAI æœåŠ¡ä½ç½®
2. è¯¥è®¢é˜…çš„ `gpt-4o-realtime-preview` é…é¢é™åˆ¶ä¸º 1 RPM (æ¯åˆ†é’Ÿè¯·æ±‚æ•°)
3. é…é¢å·²è¢«å æ»¡ï¼ˆå½“å‰ä½¿ç”¨: 1/1ï¼‰ï¼Œæ— æ³•åˆ›å»ºæ–°éƒ¨ç½²

**è¯Šæ–­è¿‡ç¨‹**:

1. **æ£€æŸ¥ç°æœ‰ Azure OpenAI èµ„æº**
   ```bash
   az cognitiveservices account list -o table
   ```
   å‘ç° 3 ä¸ª AI Services è´¦æˆ·ï¼š
   - `Infinity-AzureOpenAI` (eastus)
   - `hello-4231-resource` (eastus2) 
   - `AU-Reception-Bot` (australiaeast)

2. **æ£€æŸ¥ç°æœ‰éƒ¨ç½²**
   ```bash
   az cognitiveservices account deployment list --name <service> --resource-group <rg>
   ```
   ç»“æœï¼šæ‰€æœ‰è´¦æˆ·éƒ½æ²¡æœ‰ realtime éƒ¨ç½²ï¼Œä½†é…é¢æ˜¾ç¤ºå·²è¢«å ç”¨

3. **å°è¯•åˆ›å»º realtime éƒ¨ç½²**
   ```bash
   az cognitiveservices account deployment create \
     --model-version "2024-10-01"
   ```
   å¤±è´¥åŸå› ï¼š
   - æ¨¡å‹ç‰ˆæœ¬ `2024-10-01` å·²äº 2025-03-26 å¼ƒç”¨
   - é…é¢ä»ç„¶ä¸è¶³

4. **æŸ¥æ‰¾æœ€æ–°æ¨¡å‹ç‰ˆæœ¬**
   ```bash
   az cognitiveservices model list --location "eastus2" \
     --query "[?model.name=='gpt-4o-realtime-preview']"
   ```
   å‘ç°å¯ç”¨ç‰ˆæœ¬ï¼š
   - `2024-12-17` (å°†äº 2025-11-13 å¼ƒç”¨)
   - `2025-06-03` âœ… (æœ€æ–°ç¨³å®šç‰ˆ)

**è§£å†³æ–¹æ¡ˆ**:

ç”±äº `eastus2` åŒºåŸŸé…é¢å·²æ»¡ï¼Œé‡‡å–äº†ä»¥ä¸‹ç­–ç•¥ï¼š

1. **æ›´æ–°æ¨¡å‹ç‰ˆæœ¬**
   ```bash
   azd env set AZURE_OPENAI_REALTIME_DEPLOYMENT_VERSION "2025-06-03"
   ```
   ä»é»˜è®¤çš„ `2024-12-17` æ›´æ–°åˆ°æœ€æ–°çš„ `2025-06-03`

2. **åˆ‡æ¢åˆ° Sweden Central åŒºåŸŸ**
   ```bash
   azd env set AZURE_OPENAI_SERVICE_LOCATION "swedencentral"
   ```
   é€‰æ‹© `swedencentral` çš„åŸå› ï¼š
   - æ”¯æŒ `gpt-4o-realtime-preview` æ¨¡å‹
   - è¯¥åŒºåŸŸé…é¢ç‹¬ç«‹äº `eastus2`
   - å¯èƒ½æœ‰å¯ç”¨çš„é…é¢å®¹é‡

3. **é‡æ–°éƒ¨ç½²**
   ```bash
   azd up
   ```
   âœ… æˆåŠŸåœ¨ Sweden Central åˆ›å»º OpenAI æœåŠ¡å’Œéƒ¨ç½²

**å…³é”®æŠ€æœ¯ç‚¹**:
- Azure OpenAI çš„é…é¢æ˜¯**æŒ‰åŒºåŸŸ**è®¡ç®—çš„
- ä¸åŒåŒºåŸŸçš„é…é¢ç›¸äº’ç‹¬ç«‹
- åˆ‡æ¢åŒºåŸŸå¯ä»¥ç»•è¿‡å•ä¸€åŒºåŸŸçš„é…é¢é™åˆ¶
- ä½¿ç”¨æœ€æ–°æ¨¡å‹ç‰ˆæœ¬é¿å…å¼ƒç”¨é—®é¢˜

---

## ğŸ—ï¸ éƒ¨ç½²çš„ Azure èµ„æº

| èµ„æºç±»å‹ | èµ„æºåç§° | åŒºåŸŸ | é…ç½® |
|---------|---------|------|------|
| èµ„æºç»„ | `rg-voicerag-prod` | Brazil South | - |
| Azure OpenAI | `cog-bgvscddssk7zk` | Sweden Central | gpt-4o-realtime-preview (2025-06-03) |
| åµŒå…¥æ¨¡å‹ | `text-embedding-3-large` | Sweden Central | Standard, 30 capacity |
| AI Search | `gptkb-bgvscddssk7zk` | Brazil South | Standard å±‚, Free è¯­ä¹‰æœç´¢ |
| å­˜å‚¨è´¦æˆ· | `stbgvscddssk7zk` | Brazil South | Standard_LRS |
| Container App | `capps-backend-bgvscddssk7zk` | Brazil South | Consumption è®¡åˆ’ |
| Container Registry | `voiceragprodacrbgvscddssk7zk` | Brazil South | - |
| Container Apps ç¯å¢ƒ | `voicerag-prod-aca-env` | Brazil South | - |
| Log Analytics | `log-bgvscddssk7zk` | Brazil South | - |

---

## ğŸ“Š éƒ¨ç½²æ—¶é—´çº¿

| æ—¶é—´ç‚¹ | æ“ä½œ | è€—æ—¶ |
|-------|------|------|
| åˆå§‹ | å…‹éš†ä»“åº“ | ~10s |
| åˆå§‹ | ç¯å¢ƒæ£€æŸ¥ | ~5s |
| åˆå§‹ | Azure ç™»å½• | ~3s |
| åˆå§‹ | åˆ›å»º azd ç¯å¢ƒ | ~2s |
| **ç¬¬ä¸€æ¬¡å°è¯•** | `azd up` (eastus2) | **å¤±è´¥** - é…é¢ä¸è¶³ |
| è¯Šæ–­ | æ£€æŸ¥ç°æœ‰èµ„æºå’Œé…é¢ | ~2min |
| è¯Šæ–­ | æŸ¥æ‰¾æ¨¡å‹ç‰ˆæœ¬ | ~30s |
| ä¿®å¤ | æ›´æ–°ç¯å¢ƒå˜é‡ | ~5s |
| **ç¬¬äºŒæ¬¡éƒ¨ç½²** | `azd up` (swedencentral) | **13min 2s** âœ… |
| â””â”€ èµ„æºé…ç½® | Azure èµ„æºåˆ›å»º | ~7min |
| â””â”€ ç´¢å¼•è®¾ç½® | AI Search é›†æˆå‘é‡åŒ– | ~1min |
| â””â”€ å®¹å™¨éƒ¨ç½² | Container App éƒ¨ç½² | ~5min |

---

## ğŸ¯ éƒ¨ç½²æˆæœ

### âœ… åº”ç”¨è®¿é—®

**ç”Ÿäº§ç¯å¢ƒ URL**:  
https://capps-backend-bgvscddssk7zk.gentleisland-734d3c33.brazilsouth.azurecontainerapps.io/

**çŠ¶æ€**: ğŸŸ¢ æ­£å¸¸è¿è¡Œ (HTTP 200)

### âœ… åŠŸèƒ½éªŒè¯

å·²ä¸Šä¼ å¹¶ç´¢å¼•çš„ç¤ºä¾‹æ•°æ®ï¼š
- âœ… Northwind_Standard_Benefits_Details.pdf
- âœ… Northwind_Health_Plus_Benefits_Details.pdf
- âœ… PerksPlus.pdf
- âœ… role_library.pdf
- âœ… Benefit_Options.pdf
- âœ… employee_handbook.pdf
- âœ… Contoso_Electronics_Company_Overview.md

### âœ… é›†æˆå‘é‡åŒ–

AI Search ç´¢å¼•å™¨å·²å¯åŠ¨ï¼Œæ‰€æœ‰æœªç´¢å¼•çš„æ–‡æ¡£å°†åœ¨å‡ åˆ†é’Ÿå†…å®Œæˆç´¢å¼•ã€‚

---

## ğŸ’° æˆæœ¬ä¼°ç®—

### æŒç»­æˆæœ¬æ¥æº

1. **Azure OpenAI (GPT-4o Realtime)**
   - å®šä»·: æŒ‰ä½¿ç”¨é‡è®¡è´¹ï¼ˆè¾“å…¥/è¾“å‡º tokenï¼‰
   - é…ç½®: GlobalStandard, 1 RPM å®¹é‡
   - é¢„ä¼°: ~$XX/æœˆï¼ˆå–å†³äºä½¿ç”¨é‡ï¼‰

2. **Azure AI Search (Standard å±‚)**
   - å®šä»·: æŒ‰å°æ—¶è®¡è´¹
   - é…ç½®: 1 å‰¯æœ¬, Free è¯­ä¹‰æœç´¢
   - é¢„ä¼°: ~$250/æœˆ

3. **Azure Container Apps**
   - å®šä»·: Consumption è®¡åˆ’ï¼ŒæŒ‰å®é™…ä½¿ç”¨è®¡è´¹
   - é¢„ä¼°: ~$20-50/æœˆ

4. **Azure Storage (Standard LRS)**
   - å®šä»·: æŒ‰å­˜å‚¨é‡å’Œæ“ä½œæ¬¡æ•°è®¡è´¹
   - é¢„ä¼°: ~$5-10/æœˆ

5. **Azure Monitor / Log Analytics**
   - å®šä»·: æŒ‰æ•°æ®æ‘„å…¥é‡è®¡è´¹
   - é¢„ä¼°: ~$10-20/æœˆ

**æ€»è®¡é¢„ä¼°**: ~$285-330/æœˆï¼ˆä¸åŒ…æ‹¬ OpenAI ä½¿ç”¨æˆæœ¬ï¼‰

---

## ğŸ›‘ å¦‚ä½•å…³é—­æœåŠ¡

### æ–¹æ³• 1: å®Œå…¨åˆ é™¤æ‰€æœ‰èµ„æºï¼ˆæ¨èï¼‰

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/alserial/Documents/infinite_social/aisearch-openai-rag-audio

# åˆ é™¤æ‰€æœ‰ Azure èµ„æºï¼ˆä¼šæç¤ºç¡®è®¤ï¼‰
azd down

# æˆ–è€…å¼ºåˆ¶åˆ é™¤ï¼Œä¸æç¤ºç¡®è®¤
azd down --force

# æ°¸ä¹…åˆ é™¤è½¯åˆ é™¤çš„èµ„æºï¼ˆå¦‚ Key Vaultï¼‰
azd down --purge --force
```

**æ‰§è¡Œå**:
- âœ… åˆ é™¤æ•´ä¸ªèµ„æºç»„ `rg-voicerag-prod`
- âœ… åˆ é™¤æ‰€æœ‰ Azure èµ„æº
- âœ… åœæ­¢æ‰€æœ‰è®¡è´¹
- âŒ ä¸ä¼šåˆ é™¤æœ¬åœ°æ–‡ä»¶
- âŒ ä¸ä¼šåˆ é™¤ `.azure/` ç›®å½•ä¸­çš„ç¯å¢ƒé…ç½®

### æ–¹æ³• 2: é€šè¿‡ Azure Portal æ‰‹åŠ¨åˆ é™¤

1. ç™»å½• [Azure Portal](https://portal.azure.com)
2. å¯¼èˆªåˆ°èµ„æºç»„ `rg-voicerag-prod`
3. ç‚¹å‡» "åˆ é™¤èµ„æºç»„"
4. è¾“å…¥èµ„æºç»„åç§°ç¡®è®¤
5. ç­‰å¾…åˆ é™¤å®Œæˆï¼ˆçº¦ 5-10 åˆ†é’Ÿï¼‰

### æ–¹æ³• 3: ä»…åœæ­¢ Container Appï¼ˆæš‚åœä½†ä¿ç•™èµ„æºï¼‰

```bash
# åœæ­¢ Container Appï¼ˆä½†ä¿ç•™å…¶ä»–èµ„æºï¼‰
az containerapp revision deactivate \
  --name capps-backend-bgvscddssk7zk \
  --resource-group rg-voicerag-prod \
  --revision <revision-name>
```

**æ³¨æ„**: è¿™ç§æ–¹å¼ä¸ä¼šåœæ­¢ AI Search ç­‰å…¶ä»–èµ„æºçš„è®¡è´¹ã€‚

### âš ï¸ åˆ é™¤å‰çš„æ³¨æ„äº‹é¡¹

1. **æ•°æ®å¤‡ä»½**: ç¡®ä¿å·²å¤‡ä»½éœ€è¦çš„æ•°æ®
2. **æˆæœ¬æ ¸æŸ¥**: æ£€æŸ¥æ˜¯å¦æœ‰æœªç»“ç®—çš„è´¹ç”¨
3. **ä¾èµ–æ£€æŸ¥**: ç¡®è®¤æ²¡æœ‰å…¶ä»–æœåŠ¡ä¾èµ–è¿™äº›èµ„æº
4. **è½¯åˆ é™¤èµ„æº**: æŸäº›èµ„æºï¼ˆå¦‚ Key Vaultï¼‰æœ‰è½¯åˆ é™¤ä¿æŠ¤ï¼Œéœ€è¦ `--purge` å‚æ•°æ‰èƒ½å®Œå…¨åˆ é™¤

---

## ğŸ“ æŠ€æœ¯æ€»ç»“

### æˆåŠŸè¦ç´ 

1. **çµæ´»çš„åŒºåŸŸç­–ç•¥**
   - å½“ä¸»è¦åŒºåŸŸé…é¢ä¸è¶³æ—¶ï¼Œå¿«é€Ÿåˆ‡æ¢åˆ°å¤‡ç”¨åŒºåŸŸ
   - äº†è§£ Azure OpenAI çš„åŒºåŸŸå¯ç”¨æ€§

2. **ç‰ˆæœ¬ç®¡ç†**
   - ä½¿ç”¨æœ€æ–°çš„ç¨³å®šæ¨¡å‹ç‰ˆæœ¬
   - é¿å…ä½¿ç”¨å³å°†å¼ƒç”¨çš„ç‰ˆæœ¬

3. **å·¥å…·ç†Ÿç»ƒåº¦**
   - Azure Developer CLI (azd) ç®€åŒ–äº†éƒ¨ç½²æµç¨‹
   - Azure CLI (az) ç”¨äºè¯Šæ–­å’Œèµ„æºç®¡ç†

4. **é—®é¢˜è¯Šæ–­èƒ½åŠ›**
   - ç³»ç»Ÿæ€§æ£€æŸ¥é…é¢ä½¿ç”¨æƒ…å†µ
   - ç†è§£é”™è¯¯ä¿¡æ¯å¹¶æ‰¾åˆ°æ ¹æœ¬åŸå› 

### å­¦åˆ°çš„ç»éªŒ

1. **é…é¢æ˜¯æŒ‰åŒºåŸŸçš„**: ä¸åŒ Azure åŒºåŸŸæœ‰ç‹¬ç«‹çš„é…é¢é™åˆ¶
2. **æ¨¡å‹ç‰ˆæœ¬å¾ˆé‡è¦**: ä½¿ç”¨å¼ƒç”¨çš„ç‰ˆæœ¬ä¼šå¯¼è‡´éƒ¨ç½²å¤±è´¥
3. **swedencentral æ˜¯ realtime API çš„å¥½é€‰æ‹©**: è¾ƒæ–°çš„åŒºåŸŸå¯èƒ½æœ‰æ›´å¤šå¯ç”¨é…é¢
4. **azd ç¯å¢ƒå˜é‡å¾ˆå¼ºå¤§**: å¯ä»¥åœ¨éƒ¨ç½²å‰çµæ´»é…ç½®èµ„æº

### æ½œåœ¨æ”¹è¿›

1. **æˆæœ¬ä¼˜åŒ–**
   - è€ƒè™‘ä½¿ç”¨ Free æˆ– Basic å±‚çš„ AI Searchï¼ˆå¦‚æœåŠŸèƒ½æ»¡è¶³éœ€æ±‚ï¼‰
   - å®æ–½è‡ªåŠ¨æ‰©ç¼©å®¹ç­–ç•¥

2. **ç›‘æ§å’Œå‘Šè­¦**
   - è®¾ç½®æˆæœ¬å‘Šè­¦
   - é…ç½®åº”ç”¨æ€§èƒ½ç›‘æ§ (APM)

3. **CI/CD**
   - é›†æˆ GitHub Actions å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²
   - è®¾ç½®å¤šç¯å¢ƒï¼ˆdev/staging/prodï¼‰

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **åº”ç”¨ URL**: https://capps-backend-bgvscddssk7zk.gentleisland-734d3c33.brazilsouth.azurecontainerapps.io/
- **Azure Portal**: https://portal.azure.com/#view/HubsExtension/BrowseResourceGroups
- **é¡¹ç›®æ–‡æ¡£**: https://github.com/Azure-Samples/aisearch-openai-rag-audio
- **GPT-4o Realtime æ–‡æ¡£**: https://learn.microsoft.com/azure/ai-services/openai/how-to/real-time-audio

---

## ğŸ“ åç»­æ”¯æŒ

å¦‚éœ€è¿›ä¸€æ­¥å¸®åŠ©ï¼š
1. æŸ¥çœ‹é¡¹ç›® README.md
2. è®¿é—® Azure å®˜æ–¹æ–‡æ¡£
3. åœ¨ GitHub é¡¹ç›®é¡µé¢æäº¤ Issue

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025å¹´10æœˆ22æ—¥  
**æŠ¥å‘Šä½œè€…**: AI Assistant (Claude)  
**é¡¹ç›®çŠ¶æ€**: âœ… å·²æˆåŠŸéƒ¨ç½²å¹¶è¿è¡Œ

